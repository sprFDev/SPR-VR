<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Scene with React</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@5.1.2/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ComprehensiveVRScene = () => {
            const sceneRef = useRef(null);
            const [currentScene, setCurrentScene] = useState('main');

            useEffect(() => {
                // Register custom A-Frame component for click handling
                AFRAME.registerComponent('click-handler', {
                    init: function () {
                        this.el.addEventListener('click', function (evt) {
                            const el = evt.target;
                            const feedbackText = document.querySelector('#feedback-text');
                            const clickSound = document.querySelector('#click-sound');
                            
                            clickSound.play();
                            
                            feedbackText.setAttribute('text', 'value', 'Clicked: ' + el.id);
                            feedbackText.setAttribute('visible', true);
                            
                            const cameraEl = document.querySelector('[camera]');
                            const cameraPosition = cameraEl.getAttribute('position');
                            const direction = new THREE.Vector3().subVectors(cameraPosition, el.getAttribute('position')).normalize();
                            const textPosition = new THREE.Vector3().addVectors(el.getAttribute('position'), direction.multiplyScalar(1));
                            feedbackText.setAttribute('position', textPosition);
                            feedbackText.setAttribute('look-at', '[camera]');
                            
                            setTimeout(() => {
                                feedbackText.setAttribute('visible', false);
                            }, 2000);
                            
                            const originalColor = el.getAttribute('material').color;
                            el.setAttribute('material', 'color', '#FFF');
                            setTimeout(() => {
                                el.setAttribute('material', 'color', originalColor);
                            }, 150);
                        });
                    }
                });

                // Clean up event listener
                return () => {
                    if (sceneRef.current) {
                        sceneRef.current.removeEventListener('loaded', handleSceneLoaded);
                    }
                };
            }, []);

            // Function to generate a random position on a sphere
            const randomSpherePoint = (radius) => {
                const u = Math.random();
                const v = Math.random();
                const theta = 2 * Math.PI * u;
                const phi = Math.acos(2 * v - 1);
                const x = radius * Math.sin(phi) * Math.cos(theta);
                const y = radius * Math.sin(phi) * Math.sin(theta);
                const z = radius * Math.cos(phi);
                return { x, y, z };
            };

            // Function to position objects randomly
            useEffect(() => {
                const radius = 5; // Distance from the center
                document.querySelectorAll('.interactive').forEach((el) => {
                    const position = randomSpherePoint(radius);
                    el.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
                });
            }, [currentScene]);

            // Function to handle navigation between scenes
            const handleSceneChange = (newScene) => {
                const camera = document.querySelector('a-camera');
                camera.setAttribute('animation', {
                    property: 'position',
                    to: '0 1.6 -10',
                    dur: 2000,
                    easing: 'easeInOutQuad'
                });

                setTimeout(() => {
                    setCurrentScene(newScene);
                }, 2500);
            };

            // Main scene content
            const MainSceneContent = () => (
                <React.Fragment>
                    <a-box
                        class="interactive"
                        id="sprandco-box"
                        material="src: #sprandco-logo"
                        animation="property: rotation; to: 360 360 0; loop: true; dur: 10000"
                        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                        event-set__leave="_event: mouseleave; scale: 1 1 1"
                        click-handler
                    ></a-box>
                    
                    <a-box
                        class="interactive"
                        id="compliance-box"
                        material="src: #Compliance-Management-Tool"
                        animation="property: rotation; to: 360 0 360; loop: true; dur: 12000"
                        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                        event-set__leave="_event: mouseleave; scale: 1 1 1"
                        click-handler
                    ></a-box>
                    
                    <a-box
                        class="interactive"
                        id="inventory-box"
                        material="src: #Inventory-Management-System"
                        animation="property: rotation; to: 0 360 360; loop: true; dur: 15000"
                        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                        event-set__leave="_event: mouseleave; scale: 1 1 1"
                        click-handler
                    ></a-box>
                    
                    <a-box
                        class="interactive"
                        id="weighbridge-box"
                        material="src: #Weighbridge-Management-System"
                        animation="property: rotation; to: 360 360 360; loop: true; dur: 18000"
                        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                        event-set__leave="_event: mouseleave; scale: 1 1 1"
                        click-handler
                        onClick={() => handleSceneChange('compliance')}
                    ></a-box>
                </React.Fragment>
            );

            // Compliance scene content
            const ComplianceSceneContent = () => (
                <React.Fragment>
                    <a-box
                        rotation="-14 0 -0"
                        position="0 0 5"
                        width="1"
                        height=".5"
                        class="interactive"
                        id="back-box"
                        material="src: #back-btn"
                        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
                        event-set__leave="_event: mouseleave; scale: 1 1 1"
                        click-handler
                        onClick={() => handleSceneChange('main')}
                    ></a-box>
                    <a-video
                        position="0 2 -7" 
                        src="#Compliance_calendar"
                        width="4"
                        height="2"
                        look-at="[camera]"
                    ></a-video>
                </React.Fragment>
            );

            return (
                <a-scene ref={sceneRef}>
                    <a-assets>
                        <audio id="click-sound" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>
                        <img id="sky" src="stunning-starry-sky.jpg" />
                        <img id="sprandco-logo" src="01Compliance_Management_Tool.png" alt="Sprandco Logo" />
                        <img id="Compliance-Management-Tool" src="02-Invoice-Management-System.png" alt="Compliance Management Tool" />
                        <img id="Inventory-Management-System" src="03-Inventory-Management-System.png" alt="Inventory Management System" />
                        <img id="Weighbridge-Management-System" src="04-Weighbridge-Management-System.png" alt="Weighbridge Management System" />
                        <img id="vr_headset" src="vr_headset.png" alt="VR Headset" />
                        <img id="image_01" src="image_01.JPG" alt="Image 01" />
                        <img id="image_02" src="image_02.JPG" alt="Image 02" />
                        <img id="back-btn" src="back.png" />
                        <video id="Compliance_calendar" autoPlay loop src="complianceApp.mp4"></video>
                    </a-assets>

                    <a-sky id="image-360" radius="30" src="#sky"></a-sky>

                    <a-entity id="vr-content">
                        {currentScene === 'main' ? <MainSceneContent /> : <ComplianceSceneContent />}
                    </a-entity>

                    <a-entity
                        id="feedback-text"
                        position="0 0 -3"
                        text="value: ; align: center; color: #FFF; width: 2"
                        visible="false"
                    ></a-entity>

                    <a-entity id="rig" movement-controls="constrainToNavMesh: false;">
                        <a-camera>
                            <a-cursor
                                id="cursor"
                                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                                animation__fusing="property: fusing; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                                event-set__mouseenter="_event: mouseenter; color: springgreen"
                                event-set__mouseleave="_event: mouseleave; color: black"
                                raycaster="objects: .interactive"
                            ></a-cursor>
                        </a-camera>
                    </a-entity>
                    
                    <a-entity oculus-touch-controls="hand: left"></a-entity>
                    <a-entity oculus-touch-controls="hand: right" laser-controls raycaster="objects: .interactive;"></a-entity>
                </a-scene>
            );
        };

        ReactDOM.render(<ComprehensiveVRScene />, document.getElementById('root'));
    </script>
</body>
</html>
